<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://defra.github.io/ffc-development-guide/z_content-to-be-revised/standards/configuration-management/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Configuration management - FCP Development Guide</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Configuration management";
        var mkdocs_page_input_path = "z_content-to-be-revised/standards/configuration-management.md";
        var mkdocs_page_url = "/ffc-development-guide/z_content-to-be-revised/standards/configuration-management/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> FCP Development Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Farming and Countryside Programme (FCP) Development Guide</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Create a new service</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../create-a-new-service/">Create a new service</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting-started/">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting-started/arrange-access/">Arrange access</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting-started/cicd/">Continuous Integration and Continuous Delivery (CI/CD)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting-started/platform/">Platform</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Local development setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/">Setup local development environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-azure-cli/">Install Azure CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-detect-secrets/">Install Detect Secrets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-docker-compose/">Install Docker Compose</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-docker-desktop/">Install Docker Desktop</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-dotnet-sdk/">Install .NET SDK</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-github/">Install GitHub CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-kubectl/">Install kubectl</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-node-version-manager/">Install Node Version Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-openvpn/">Install OpenVPN</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-snyk/">Install Snyk CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-sonarlint/">Install SonarLint</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-standard-js/">Install StandardJs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-vs-code/">Install IDE</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/install-wsl/">Install Windows Subsystem for Linux (WSL)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/installing-helm/">Install Helm</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/mount-windows-drives-in-wsl/">Mount Windows drives in WSL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/setup-macos-command-line-tools/">Setup command line tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/setup-sudoers/">Add user to sudoers file</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../local-development-setup/sign-commits/">Setup commit signing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Z content to be revised</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">Guides</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/">Guides</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/accounts/">Accounts</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/availability-alerts/">Availability Alert Setup Guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/backlog-management/">Backlog management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/debug-dotnet-container/">Debugging .NET Core in a Linux container</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/demo-service/">Demo service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/developing-in-container/">Developing in a container</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/google-tag-manager/">Google Tag Manager</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/jlm/">Joiners, movers and leavers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/pact-broker/">Pact Broker</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/redis-caching/">Redis Caching in Hapi</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/secrets-management/">Secrets Management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/shared-assets/">Shared assets</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/troubleshooting/">Troubleshooting Guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/vs-code-wsl1/">Using Visual Studio Code with WSL1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/vulnerabilities/">Managing vulnerabilities</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../guides/waf-waiver/">WAF waivers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Kubernetes</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/">Kubernetes</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/configure-nginx-ingress-controller/">Configure NGINX Ingress Controller</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/create-namespace/">Creating a workstream namespace</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/install-kubernetes-dashboard/">Install Kubernetes dashboard</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/interaction/">Interact with cluster</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/pod-identity/">AAD Pod Identity</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/kubernetes/probes/">Probes</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Resource provisioning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/resource-provisioning/">Resource provisionsing</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/resource-provisioning/ci-pipeline/">FFC CI Pipeline</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/resource-provisioning/managed-identity/">Azure Managed Identity</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/resource-provisioning/postgres-database/">Postgres Database</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/resource-provisioning/release-pipeline/">Release pipelines</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../guides/resource-provisioning/servicebus-queues/">Azure Service Bus Queues, Topics and Subscriptions</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Standards</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../">Standards</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/">API Standards</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../backlog-management/">Backlog management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ci-pipeline/">FFC CI pipeline</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../code-review/">Code review</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Configuration management</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#helm-values-in-deployment">Helm values in deployment</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-naming-standards">Key naming standards</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#commonkey">common/key</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#environmentkey">environment/key</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#servicecommonkey">service/common/key</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#serviceenvironmentkey">service/environment/key</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#prkey">pr/key</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#microservice-specific-values">Microservice specific values</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#order-values-are-overridden">Order values are overridden</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#deciding-which-convention-to-use">Deciding which convention to use</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#exceptions-to-the-rule">Exceptions to the rule</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#updating-values">Updating values</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../documentation/">Documentation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../events/">Events and messages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../jenkins/">Jenkins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../quick-reference/">Quick reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../release-notes/">Release notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../route-to-live/">Route to live</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../secrets-management/">Secrets Management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../source-code/">Source code</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../technology-stack/">Technology Stack</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../testing/">Testing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../version-control/">Version Control</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Kubernetes</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/">Kubernetes</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/configuration/">Configuration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/helm-charts/">Helm chart</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/labels/">Labels</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/priority/">Pod priority</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/probes/">Probes</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/rbac/">Role Based Access Control (RBAC)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/resource-usage/">Resource usage</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../kubernetes/secrets/">Secrets</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">FCP Development Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Z content to be revised</li>
          <li class="breadcrumb-item">Standards</li>
      <li class="breadcrumb-item active">Configuration management</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="configuration-management">Configuration management</h1>
<p>Non sensitive application configuration data is persisted in <a href="https://azure.microsoft.com/en-gb/services/app-configuration/">Azure Application Configuration</a>.</p>
<p>Sensitive application data is persisted in <a href="https://azure.microsoft.com/en-gb/services/key-vault/">Azure Key Vault</a> and referenced from Application Configuration.</p>
<p>One instance of Azure Key Vault and Azure Application Configuration will exist in every FFC Azure subscription.</p>
<p>The configuration keys used in Application Configuration must follow FFC naming convention below to ensure that CI and CD pipelines can retrieve values in a predictable and efficient way.</p>
<h2 id="helm-values-in-deployment">Helm values in deployment</h2>
<p>During deployment, our CI or CD pipeline will read the <code>values.yaml</code> file in the Helm chart to identify all potential configuration values that may need to be sourced from Application Configuration and then matches each of them by key name.</p>
<p>For example, if a helm chart contains the below, then the key to be matched will be <code>container.port</code>.</p>
<pre><code>container:
  port: 3000
</code></pre>
<p>If a key exists then the value, <code>3000</code> in the example, will be overwritten with the value in Application Configuration.</p>
<h2 id="key-naming-standards">Key naming standards</h2>
<p>As all FFC teams will be sharing a single instance of Application Configuration in each subscription and that subscription may host multiple environments, we need to ensure our key naming convention is scalable, performant and avoids duplication where possible.</p>
<p>There are five accepted formats a key name can follow.  The examples all use the <code>container.port</code> key as a demonstration for simplicity.</p>
<h3 id="commonkey"><code>common/key</code></h3>
<p>These are values that are consistent, regardless of service or environment. </p>
<p>For example <code>common/container.port</code> would mean all services would all get the same value wherever they deploy.</p>
<p>The <code>common/</code> text is necessary due to the limitation the Azure CLI used in pipelines returns keys. 
Without the prefix there would be no way to only return these common items.</p>
<h3 id="environmentkey"><code>environment/key</code></h3>
<p>These are values that are environment specific, but not service specific.  </p>
<p>For example, <code>dev/container.port</code> would mean all services would get the same value when deploying to the <code>dev</code> environment.</p>
<h3 id="servicecommonkey"><code>service/common/key</code></h3>
<p>These are values that are service specific, but not environment specific.</p>
<p>For example, <code>ffc-demo/common/container.port</code> would mean all deployments belonging to the <code>ffc-demo</code> service would get the same value wherever they deploy.</p>
<p>As before the <code>/common/</code> text is necessary to ensure the Azure CLI returns only relevant values.</p>
<h3 id="serviceenvironmentkey"><code>service/environment/key</code></h3>
<p>These are values that are service and environment specific.</p>
<p>For example, <code>ffc-demo/dev/container.port</code> would mean all deployments belonging to the <code>ffc-demo</code> service would get the same value when deploying to the <code>dev</code> environment.</p>
<h3 id="prkey"><code>pr/key</code></h3>
<p>These are only used for PR deployments in CI when you need to provide a different value for that PR deployment and still be able to provide individual microservie labels (see below).  They are also used by CI to obtain dynamic infrastructure values.</p>
<p>For example, <code>pr/container.port</code> would mean all PR deployments would get the same port value.</p>
<h2 id="microservice-specific-values">Microservice specific values</h2>
<p>When you want to provide a value depending on the specific microservice and not just the service you can add a different label to that key referencing the name of the microservice.</p>
<p>For example, if you have a key <code>ffc-demo/common/container.port</code> with an unlabelled value of <code>4000</code> and a value of <code>5000</code> labelled <code>ffc-demo-web</code>, then all <code>ffc-demo</code> services would get a value of <code>4000</code> except the <code>ffc-demo-web</code> microservice which would get <code>5000</code>.</p>
<h2 id="order-values-are-overridden">Order values are overridden</h2>
<p>Within the CI and CD pipelines, the values will be sourced and overwritten in the following order.</p>
<ol>
<li><code>common/key</code></li>
<li><code>common/key</code> plus microservice label</li>
<li><code>environment/key</code></li>
<li><code>environment/key</code> plus microservice label</li>
<li><code>service/common/key</code></li>
<li><code>service/common/key</code> plus microservice label</li>
<li><code>service/environment/key</code></li>
<li><code>service/environment/key</code> plus microservice label</li>
<li><code>pr/key</code> (CI PR deployment only)</li>
<li><code>pr/key</code> plus microservice label (CI PR deployment only)</li>
</ol>
<h2 id="deciding-which-convention-to-use">Deciding which convention to use</h2>
<p>To improve performance in CI, keys should follow a convention that gives the narrowest scope possible.  </p>
<p>For example, if a value is only used for one service or will vary depending on the service then it should be scoped to either <code>service/common</code> or <code>service/environment</code></p>
<p>Only values that are used by everyone should be scoped to <code>common/</code> or <code>environment/</code></p>
<h3 id="exceptions-to-the-rule">Exceptions to the rule</h3>
<p>The are some values that are exceptions to this rule because of dynamic infrastructure provisioning and related test execution in CI.</p>
<blockquote>
<p>Note: these exceptions only apply to the Sandpit (<code>SND</code>) environment.</p>
</blockquote>
<h4 id="ingress-values">Ingress values</h4>
<p>FFC Helm charts define their ingress resources like the below:</p>
<pre><code>ingress:
  server:
  endpoint:
  class:
</code></pre>
<p>These values must use the hierarchy <code>environment/key</code> for example <code>dev/ingress.server</code> and use labels to separate each service's value.</p>
<h4 id="database-values">Database values</h4>
<p>FFC Helm charts define their database names like the below:</p>
<pre><code>postgresService:
  postgresUser:
  postgresDb:
</code></pre>
<p>These values must use the hierarchy <code>environment/key</code> for example <code>dev/postgresService.postgresUser</code> and use labels to separate each service's value. </p>
<h2 id="updating-values">Updating values</h2>
<p>In Sandpit, values are added direct to Application Configuration via the Azure Portal or Azure CLI.</p>
<p>In higher environments values are added by an Azure DevOps pipeline that sources configuration from a <a href="https://dev.azure.com/defragovuk/DEFRA-FFC/_git/DEFRA-FFC-INFRA?path=/arm-templates/app-config/parameters">git repository</a>.</p>
<p>Full details for maintaining application configuration can be found in <a href="https://dev.azure.com/defragovuk/DEFRA-FFC/_wiki/wikis/DEFRA-FFC.wiki/5183/App-Configuration-Changes">this wiki</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../code-review/" class="btn btn-neutral float-left" title="Code review"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../documentation/" class="btn btn-neutral float-right" title="Documentation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../code-review/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../documentation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
