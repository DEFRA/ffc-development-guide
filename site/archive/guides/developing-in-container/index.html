
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://defra.github.io/ffc-development-guide/archive/guides/developing-in-container/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>Developing in a container - FCP Development Guide</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developing-in-a-container" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="FCP Development Guide" class="md-header__button md-logo" aria-label="FCP Development Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FCP Development Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developing in a container
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/DEFRA/ffc-development-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="FCP Development Guide" class="md-nav__button md-logo" aria-label="FCP Development Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    FCP Development Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DEFRA/ffc-development-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/platform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understand the Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understand CI/CD approach
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/arrange-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arrange access to resources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup your local development environment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Setup your local development environment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Windows
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Windows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-wsl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Windows Subsystem for Linux (WSL)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/mount-windows-drives-in-wsl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mount windows drives in WSL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/setup-sudoers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add user to sudoers file
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    macOs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            macOs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/setup-macos-command-line-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup command line tools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Common
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Common
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-docker-desktop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Docker Desktop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-vs-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Visual Studio Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-standard-js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install StandardJs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-sonarlint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install SonarLint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/setup-commit-signing.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup commit signing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Docker Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-detect-secrets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Detect Secrets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-node-version-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Node Version Manager (NVM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-dotnet-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install .NET SDK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-kubectl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install kubectl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-helm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Helm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-azure-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Azure CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-snyk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Snyk CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install GitHub CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../local-development-setup/install-openvpn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install OpenVPN
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Create a new service
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Create a new service
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../create-a-new-service/choose-a-technology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choose a technology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../create-a-new-service/github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a source code repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../create-a-new-service/conventions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repository conventions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../create-a-new-service/jenkins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup a Jenkins CI pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../create-a-new-service/ado/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup an Azure DevOps CD pipeline
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development patterns
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/containers.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/configuration.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration and secrets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/azure-service-bus.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Messaging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/azure-storage.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/azure-postgresql.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/azure-redis.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/azure-application-insights.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/defra-identity.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-patterns/azure-ad.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal users
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/unit-testing.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/integration.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/contract.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contract
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/performance.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/security.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/accessibility.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessibility
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/compatibility.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compatibility
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive content
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Archive content
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guides
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Compose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker Compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-composeyaml" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-composeoverrideyaml" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose.override.yaml
    </span>
  </a>
  
    <nav class="md-nav" aria-label="docker-compose.override.yaml">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avoiding-port-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      Avoiding port conflicts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-composedebugyaml" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose.debug.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-composetestyaml" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose.test.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-composetestwatchyaml" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose.test.watch.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-composetestdebugyaml" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose.test.debug.yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packagejson-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      package.json scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="package.json scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pretest" class="md-nav__link">
    <span class="md-ellipsis">
      pretest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testwatch" class="md-nav__link">
    <span class="md-ellipsis">
      test:watch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testwatch_1" class="md-nav__link">
    <span class="md-ellipsis">
      test:watch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testdebug" class="md-nav__link">
    <span class="md-ellipsis">
      test:debug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testlint" class="md-nav__link">
    <span class="md-ellipsis">
      test:lint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#startwatch" class="md-nav__link">
    <span class="md-ellipsis">
      start:watch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#startdebug" class="md-nav__link">
    <span class="md-ellipsis">
      start:debug
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convenience-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Convenience scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Convenience scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scriptsstart" class="md-nav__link">
    <span class="md-ellipsis">
      ./scripts/start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptstest" class="md-nav__link">
    <span class="md-ellipsis">
      ./scripts/test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="./scripts/test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Optional arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-code-running-in-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging code running in a container
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Debugging code running in a container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-debugging-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Application debugging profiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application debugging profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attach-to-an-already-running-container" class="md-nav__link">
    <span class="md-ellipsis">
      Attach to an already running container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-an-application-in-debug-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Start an application in debug mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Test debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-debugging-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Other debugging profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-useful-docker-development-guides" class="md-nav__link">
    <span class="md-ellipsis">
      Other useful Docker development guides
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="developing-in-a-container">Developing in a container</h1>
<p>The FFC Architecture Vision prescribes a containerised microservice ecosystem.  Docker is the containerisation technology used within Defra.</p>
<p>Containers are lightweight and fast. One of their main benefits for developers is that it is simple to replicate an applicationâ€™s environment and dependencies locally consistently. </p>
<p>Crucially, they enable a workflow for your code that allows you to develop and test locally, push to upstream, and be confident that what you have built locally will work in CI and any environment.</p>
<p>The following guide has a strong focus on Node.js as it is the primary technology choice of FFC and Defra.  However, details of debugging .NET containers is included in <a href="../debug-dotnet-container/">another guide</a>.</p>
<h2 id="docker">Docker</h2>
<p>All FFC microservices are built from supported Defra parent images for Node.js and .NET.  A <code>Dockerfile</code> will be included in each microservice repository containing a multi-stage build definition referencing these images.</p>
<p>All microservice repositories created from the <a href="https://github.com/DEFRA/ffc-template-node">FFC Node template</a> will include this <code>Dockerfile</code> already configured.</p>
<h2 id="docker-compose">Docker Compose</h2>
<p><a href="https://docs.docker.com/compose/">Docker Compose</a> is a tool for defining and running multi-container Docker applications using yaml configuration files.</p>
<p>All microservice repositories created from the <a href="https://github.com/DEFRA/ffc-template-node">FFC Node template</a> include a pre-configured set of Docker Compose yaml files to support local development and testing as well as some being a prerequisite for CI capability.</p>
<p>An example Node.js <code>Dockerfile</code> showing a multi-stage build for both development and production.  Note that the <code>development</code> image runs the application in <code>watch</code> mode to support local development and testing, whilst <code>production</code> simply runs the application.</p>
<p><code>development</code> is dependent on the local <code>package.json</code> including a watch script.  More on this below.</p>
<pre><code>ARG PARENT_VERSION=1.2.9-node14.17.6
ARG PORT=3000
ARG PORT_DEBUG=9229

# Development
FROM defradigital/node-development:${PARENT_VERSION} AS development
ARG PARENT_VERSION
LABEL uk.gov.defra.ffc.parent-image=defradigital/node-development:${PARENT_VERSION}

ARG PORT
ARG PORT_DEBUG
ENV PORT ${PORT}
EXPOSE ${PORT} ${PORT_DEBUG}

COPY --chown=node:node package*.json ./
RUN npm install
COPY --chown=node:node . .
CMD [ &quot;npm&quot;, &quot;run&quot;, &quot;start:watch&quot; ]

# Production
FROM defradigital/node:${PARENT_VERSION} AS production
ARG PARENT_VERSION
LABEL uk.gov.defra.ffc.parent-image=defradigital/node:${PARENT_VERSION}

ARG PORT
ENV PORT ${PORT}
EXPOSE ${PORT}

COPY --from=development /home/node/app/ ./app/
COPY --from=development /home/node/package*.json ./
RUN npm ci
CMD [ &quot;node&quot;, &quot;app&quot; ]
</code></pre>
<h3 id="docker-composeyaml"><code>docker-compose.yaml</code></h3>
<p>Used to define creation of the production image locally and in CI.  This file should include all configuration needed to create a clean production image.  Port and local volume mapping should be avoided in this file.</p>
<p>The template repository will set a <code>container_name</code> property in this file so that containers created have shorter and more predictable names to support local development.  However, if local scaling of container instances is required, then this property should be removed as container names will need to be dynamic in that scenario.</p>
<p>To avoid duplication, other dependent container images can be defined in this file such as PostgreSQL or Redis, but no volume or port bindings for those dependencies should be included.</p>
<h3 id="docker-composeoverrideyaml"><code>docker-compose.override.yaml</code></h3>
<p>Used to apply overrides to <code>docker-compose.yaml</code> to support local development.  This is where port and volume mappings should be declared.</p>
<p>If dependencies such as PostgreSQL or Redis are used, this is the file where volume and port bindings should be declared for those dependencies.</p>
<p>This image will build the <code>development</code> image which typically is the same as production but will run the code in <code>watch</code> mode so changes made to the code locally are automatically picked up in the container and restart the application.</p>
<h4 id="avoiding-port-conflicts">Avoiding port conflicts</h4>
<p>When binding container ports to localhost, it is important to consider any conflicts that may occur with other services developers may wish to run locally.</p>
<p>For example, if a service is made up of two microservices, both running on port <code>3000</code>.  Then both cannot be mapped to <code>localhost:3000</code> without a conflict.</p>
<p>In this scenario, to successfully run both services on the same device with port binding, one of the services should bind the container's port <code>3000</code> to a different localhost port.</p>
<p>The same consideration should be given to the debug port exposed to avoid a conflict on port <code>9229</code>, the default Node debug port.</p>
<pre><code># service 1 docker-compose.override.yaml
ports:
  - &quot;3000:3000&quot;
  - &quot;9229:9229&quot;

# service 2 docker-compose.override.yaml
ports:
  - &quot;3001:3000&quot;
  - &quot;9230:9229&quot;
</code></pre>
<p>This equally applies when binding dependency images such as PostgreSQL and Redis.</p>
<h3 id="docker-composedebugyaml"><code>docker-compose.debug.yaml</code></h3>
<p>Used to start application in debug mode.  This is only required if you wish the application to wait for the debugger before starting the application.  If you just wish to attach a debugger to an already running instance, the override file is sufficient.</p>
<h3 id="docker-composetestyaml"><code>docker-compose.test.yaml</code></h3>
<p>Used to run all tests in the repository.  This is a dependency of the FFC CI pipeline.  Port bindings should be avoided in this file to avoid conflicts between running builds.</p>
<h3 id="docker-composetestwatchyaml"><code>docker-compose.test.watch.yaml</code></h3>
<p>Used as an override to <code>docker-compose.test.yaml</code> to run tests in <code>watch</code> mode to support Test Driven Development (TDD).  Changes to either application or test code will automatically trigger re-running of affected tests.</p>
<p>All Node.js FFC microservices use <a href="https://jestjs.io/">Jest</a>.  Jest has powerful capability to support multiple watch scenarios such as running individual tests, only tests affected by changes, only failed tests, filtering by regular expression as well as running the full suite.</p>
<p>In order to understand which code has changed, Jest uses the local <code>.git</code> directory.  This means when running tests in a container, the local <code>.git</code> folder must be mounted to the container in <code>docker-compose.watch.yaml</code>.</p>
<pre><code>volumes:
  - ./.git:/home/node/.git
</code></pre>
<h3 id="docker-composetestdebugyaml"><code>docker-compose.test.debug.yaml</code></h3>
<p>Used to run Jest in watch mode but support debugging of tests.  This allows developers to have all the capability of <code>watch</code> but with the added bonus of being able to attach a debugger.</p>
<p>Details of debugging tests are below.</p>
<h2 id="packagejson-scripts">package.json scripts</h2>
<p>To enable the capability provided by the above Docker Compose files, <code>package.json</code> needs to be configured to support the scripts referenced in the <code>command</code>.</p>
<p>Below is an extract of the default <code>package.json</code> file provided by <a href="https://github.com/DEFRA/ffc-template-node">FFC Node template</a>.</p>
<pre><code>&quot;scripts&quot;: {
    &quot;pretest&quot;: &quot;npm run test:lint&quot;,
    &quot;test&quot;: &quot;jest --runInBand --forceExit&quot;,
    &quot;test:watch&quot;: &quot;jest --coverage=false --onlyChanged --watch --runInBand&quot;,
    &quot;test:debug&quot;: &quot;node --inspect-brk=0.0.0.0 ./node_modules/jest/bin/jest.js --coverage=false --onlyChanged --watch --runInBand --no-cache&quot;,
    &quot;test:lint&quot;: &quot;standard&quot;,
    &quot;start:watch&quot;: &quot;nodemon --inspect=0.0.0.0 --ext js --legacy-watch app/index.js&quot;,
    &quot;start:debug&quot;: &quot;nodemon --inspect-brk=0.0.0.0 --ext js --legacy-watch app/index.js&quot;
</code></pre>
<h3 id="pretest"><code>pretest</code></h3>
<p>This will automatically run before the <code>test</code> script and will lint all JavaScript files in according with StandardJs standards.</p>
<h3 id="test"><code>test</code></h3>
<p>This will run all Jest tests within the repository with no watch mode enabled and will output code coverage results on test completion.  This is primary used for CI, but can be run locally as a quick check of test status.</p>
<p><code>--runInBand</code> will ensure that tests run sequentially rather than parallel.  Although this will result in slower running overall, it means that integration tests spanning containers have connections that are cleanly and predictably open and closed to avoid test disruption.</p>
<p><code>--forceExit</code> will force Jest close a test with open connections 1 second after completion of the test.  Ideally this would not be needed, however in some scenarios Jest is unable to determine whether a Hapi server is still running even if it is cleanly shut down in the test.</p>
<h3 id="testwatch"><code>test:watch</code></h3>
<p>This will run tests in <code>watch</code> mode and is the most commonly used by developers to support TDD.</p>
<p><code>--coverage=false</code> - as typically only running a subset of tests, there is little value displaying a test coverage summary.  Disabling it also reduces lines written to the console to support developer focus.</p>
<p><code>--onlyChanged</code> - start by only running tests that are affected by code changes.  Accuracy of this is dependent on the <code>.git</code> folder being mounted to the volume as described above as well as the folders containing test and application code.</p>
<p><code>--watch</code> - will run tests in watch mode, so as code, either in application or test, is changed the tests are automatically re-run.  Developers have the option to change the behaviour of watch mode.</p>
<h3 id="testwatch_1"><code>test:watch</code></h3>
<p>This will run tests in <code>watch</code> mode and is the most commonly used by developers to support TDD.</p>
<p><code>--coverage=false</code> - as typically only running a subset of tests, there is little value displaying a test coverage summary.  Disabling it also reduces lines written to the console to support developer focus.</p>
<p><code>--onlyChanged</code> - start by only running tests that are affected by code changes.  Accuracy of this is dependent on the <code>.git</code> folder being mounted to the volume as described above.</p>
<p><code>--watch</code> - will run tests in watch mode, so as code, either in application or test, is changed the tests are automatically re-run.  Developers have the option to change the behaviour of watch mode.</p>
<h3 id="testdebug"><code>test:debug</code></h3>
<p>This runs tests in <code>watch</code> mode and has all the same behaviour and running options as <code>test:watch</code>.  However, the key difference it this will wait for a debugger to be attached before starting test execution.  This enables developers to apply breakpoints in the test and application code to debug troublesome tests.</p>
<p>An example Visual Studio Code debugging profile to use this script is provided below.</p>
<p><code>--no-cache</code> - Jest caches files between test runs which can result in some breakpoints not being hit.  This disables that behaviour.</p>
<h3 id="testlint"><code>test:lint</code></h3>
<p>Run linting with StandardJs only.</p>
<h3 id="startwatch"><code>start:watch</code></h3>
<p>Starts the application in watch mode.  This is typically how developers will run all applications locally.  As code is changed, the running application in the container automatically identifies the changes and restarts the running application.</p>
<p><a href="https://www.npmjs.com/package/nodemon">Nodemon</a> is used to orchestrate restarting of the application.</p>
<p>This is dependent on the application code folder having a volume binding to the container.</p>
<h3 id="startdebug"><code>start:debug</code></h3>
<p>This has the same behaviour as <code>start:watch</code> but like <code>test:debug</code> will wait for a debugger to be attached before executing any code.</p>
<h2 id="convenience-scripts">Convenience scripts</h2>
<p>Repositories created from <a href="https://github.com/DEFRA/ffc-template-node">FFC Node template</a> will include two convenience scripts to support developers easily running the application utilising the above setup.</p>
<h3 id="scriptsstart"><code>./scripts/start</code></h3>
<p>Run the application using Docker Compose.  Typically this is just a simple abstraction over <code>docker-compose up</code> however, is can be extended to ensure container runs in a specific container network or run database migrations prior to starting the application for example.</p>
<h3 id="scriptstest"><code>./scripts/test</code></h3>
<p>Run tests.  Without any arguments provided will run the <code>test</code> script in <code>package.json</code>.</p>
<p>To ensure clean running, all test containers are recreated.  Note that this will not affect data persisted in development databases for example if the above setup is followed.</p>
<h4 id="optional-arguments">Optional arguments</h4>
<p><code>-h</code> - shows all available arguments.</p>
<p><code>-w</code> - runs tests in watch mode using <code>test:watch</code> script</p>
<p><code>-d</code> - runs tests in debug mode using <code>test:debug</code> script</p>
<h2 id="debugging-code-running-in-a-container">Debugging code running in a container</h2>
<p>If the above setup is followed, then everything is in place to support debugging of applications and tests in containers.</p>
<p>Developers are free to use their own choice of IDE, however, all example debug configurations within this guide will assume Visual Studio Code is used.</p>
<p>These debug configurations should all be included in a <code>launch.json</code> file in the <code>.vscode</code> folder at the root of the repository.  This folder should be excluded from source control.</p>
<h3 id="application-debugging-profiles">Application debugging profiles</h3>
<h4 id="attach-to-an-already-running-container">Attach to an already running container</h4>
<pre><code>{
  &quot;name&quot;: &quot;Docker: Attach&quot;,
  &quot;type&quot;: &quot;node&quot;,
  &quot;request&quot;: &quot;attach&quot;,
  &quot;restart&quot;: true,
  &quot;port&quot;: 9229,
  &quot;remoteRoot&quot;: &quot;/home/node&quot;,
  &quot;skipFiles&quot;: [
    &quot;&lt;node_internals&gt;/**&quot;,
    &quot;**/node_modules/**&quot;
  ]
}
</code></pre>
<p>This will attach to the node process exposed by the debug port.  Note that this uses the <code>localhost</code> port not the container port.  So if port <code>9229</code> is bound to a different port locally, then this value should be changed to match here.</p>
<p><code>restart</code> - will ensure that as code is changed and the application restarted, the debugger is automatically reattached.</p>
<p><code>remoteRoot</code> - must match the location of the code that matches the local workspace structure.  When using the Node.js Defra Docker base images the location will always be <code>home/node</code>.</p>
<p><code>skipFiles</code> - an array of locations where debugging such skip.  Typically this would be internal Node.js code as well as those from third party npm modules.</p>
<h4 id="start-an-application-in-debug-mode">Start an application in debug mode</h4>
<pre><code>{
      &quot;name&quot;: &quot;Docker: Attach Launch&quot;,
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;attach&quot;,
      &quot;remoteRoot&quot;: &quot;/home/node&quot;,
      &quot;restart&quot;: true,
      &quot;port&quot;: 9229,
      &quot;skipFiles&quot;: [
        &quot;&lt;node_internals&gt;/**&quot;,
        &quot;**/node_modules/**&quot;
      ],
      &quot;preLaunchTask&quot;: &quot;compose-debug-up&quot;,
      &quot;postDebugTask&quot;: &quot;compose-debug-down&quot;
    },
</code></pre>
<p>This will start a new container in debug mode using the <code>start:debug</code> <code>package.json</code> script.  The application will wait for a debugger before running any code.</p>
<p>This is dependent on <code>preLaunchTask</code> and <code>postDebugTask</code> being defined in a <code>.vscode/tasks.json</code> file.</p>
<p>An example of this is below.</p>
<pre><code>{
  &quot;version&quot;: &quot;2.0.0&quot;,
  &quot;tasks&quot;: [
    {
      &quot;label&quot;: &quot;compose-debug-up&quot;,
      &quot;type&quot;: &quot;shell&quot;,
      &quot;command&quot;: &quot;docker-compose -f docker-compose.yaml -f docker-compose.override.yaml -f docker-compose.debug.yaml up -d&quot;
    },
    {
      &quot;label&quot;: &quot;compose-debug-down&quot;,
      &quot;type&quot;: &quot;shell&quot;,
      &quot;command&quot;: &quot;docker-compose -f docker-compose.yaml -f docker-compose.override.yaml -f docker-compose.debug.yaml down&quot;
    }
  ]
}
</code></pre>
<h3 id="test-debugging">Test debugging</h3>
<pre><code>{
  &quot;name&quot;: &quot;Docker: Jest Attach&quot;,
  &quot;type&quot;: &quot;node&quot;,
  &quot;request&quot;: &quot;attach&quot;,
  &quot;port&quot;: 9229,
  &quot;restart&quot;: true,
  &quot;timeout&quot;: 10000,
  &quot;remoteRoot&quot;: &quot;/home/node&quot;,
  &quot;disableOptimisticBPs&quot;: true,
  &quot;continueOnAttach&quot;: true,
  &quot;skipFiles&quot;: [
    &quot;&lt;node_internals&gt;/**&quot;,
    &quot;**/node_modules/**&quot;
  ]
}
</code></pre>
<p>This assumes that the <code>./script/test -d</code> command referenced above has already been run and the test suit is waiting for the debugger to attach. 
This profile will attach that debugger.</p>
<p><code>disableOptimisticBPs</code> - this needs to be set as <code>true</code> as Jest takes a copy of all test files and uses these copies for execution.  If this is not disabled then this process can result in breakpoints not being mapped to their correct location.</p>
<p><code>continueOnAttach</code> - instruct the pending test execution to continue once the debugger is attached.</p>
<h2 id="other-debugging-profiles">Other debugging profiles</h2>
<p>A range of different debugging profiles can be found in <a href="https://github.com/johnwatson484/vscode-debug-profiles-node">this repository</a> as well as a test application setup to the above standards to test them.</p>
<h2 id="other-useful-docker-development-guides">Other useful Docker development guides</h2>
<p>Defra has well documented <a href="https://github.com/DEFRA/software-development-standards/blob/master/standards/container_standards.md">standards</a> and <a href="https://github.com/DEFRA/software-development-standards/blob/master/guides/docker_guidance.md">guidance</a> on developing with containers, that provides further examples of good local development practice.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>